#+title: Crowdfunding
#+PROPERTY: header-args :var base-url="http://localhost:4000" token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiZW1haWwiOiJjcm93ZGZ1bmRpbmdAZ21haWwuY29tIiwiaWF0IjoxNjE5NzMxMDA2LCJleHAiOjE2MjA1OTUwMDYsImp0aSI6IjI3b2IwcDYyOTl1a28zZTByOWoifQ.E5UaPB2fx0yKPlRchaNsIXHbKBBE3FL01vyPEBHUhk4"

* DB
- Run container :: ~docker-compose up~
- Enter to container :: ~docker-compose exec mysql mysql -uroot -ppassword~
** Ubigeo
- Fill /region/, /province/ and /district/ dbs run :: ~npm run seed~
* Routes
** Ubigeo
- Departamentos :: GET ~/regions~
- Provincias :: GET ~/provinces/:id~
- Distritos :: GET ~/districts/:id~
** Create user
#+begin_src restclient
POST :base-url/user
Content-Type: application/json;charset=UTF-8
{
    "email":"crowdfunding00@gmail.com",
    "name":"Ariana",
    "lastname":"Perez",
    "phone":"909823098123",
    "password":"roblox"
}
#+end_src

** Login
#+begin_src restclient
POST :base-url/auth
Content-Type: application/json;charset=UTF-8
{
    "email":"crowdfunding@gmail.com",
    "password":"roblox"
}
#+end_src

#+begin_src restclient
POST :base-url/user/logout
Authorization: Bearer :token
#+end_src

*** Failed
- Wrong email
#+begin_src restclient :exports both
POST :base-url/auth
Content-Type: application/json;charset=UTF-8
{
    "email":"crowdfunding2@gmail.com",
    "password":"roblox"
}
#+end_src

#+RESULTS:
#+BEGIN_SRC text
El correo electrónico que ingresó no pertenece a ninguna cuenta.
POST http://localhost:4000/auth
HTTP/1.1 401 Unauthorized
Vary: Origin
Content-Type: text/plain; charset=utf-8
Content-Length: 66
Date: Tue, 04 May 2021 19:48:40 GMT
Connection: keep-alive
Keep-Alive: timeout=5
Request duration: 0.011135s
#+END_SRC

- Wrong password
#+begin_src restclient :exports both
POST :base-url/auth
Content-Type: application/json;charset=UTF-8
{
    "email":"crowdfunding@gmail.com",
    "password":"roblox2"
}
#+end_src

#+RESULTS:
#+BEGIN_SRC text
Contraseña incorrecta
POST http://localhost:4000/auth
HTTP/1.1 401 Unauthorized
Vary: Origin
Content-Type: text/plain; charset=utf-8
Content-Length: 22
Date: Tue, 04 May 2021 19:50:18 GMT
Connection: keep-alive
Keep-Alive: timeout=5
Request duration: 0.122258s
#+END_SRC

** Campaign
*** Create campaign
#+begin_src restclient
POST :base-url/user/campaign
Content-Type: application/json
Authorization: Bearer :token
{
    "name":"Regalando Sonrisas",
    "type":"materiales"
}
#+end_src

*** List all campaigns by user
#+begin_src restclient
:base-url = http://localhost:4000/user/campaign
GET :base-url
Content-Type: application/json
Authorization: Bearer :token
#+end_src

** Beneficiary
*** Create beneficiary
#+begin_src restclient
POST :base-url/beneficiary
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
{
    "name": "Carmelolll",
    "lastname": "Gallo",
     "maternal_lastname": "Valiente",
    "sex": "m",
    "nse": "__",
    "document": "65465412",
    "age": 45,
    "district": 20,
    "address": "laskdjf",
    "status": "lsakdjf",
    "campaign": 2
}
#+end_src

*** Get beneficiary by campaign
#+begin_src restclient
GET :base-url/beneficiary?idCampaign=2
Authorization: Bearer :token
#+end_src

*** Update beneficiary
#+begin_src restclient
PUT :base-url/beneficiary
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
{
    "id": 5,
    "name": "Carmela",
    "lastname": "Gallo",
     "maternal_lastname": "Valiente",
    "sex": "m",
    "nse": "__",
    "document": "65465412",
    "age": 45,
    "district": 20,
    "address": "laskdjf",
    "handicapped":true,
    "campaign": 13
}
#+end_src

*** Delete beneficiary
#+begin_src restclient
PUT :base-url/beneficiary/remove
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
{
    "id": 12,
    "name": "Carmelo",
    "lastname": "Torres",
     "maternal_lastname": "Valiente",
    "sex": "m",
    "nse": "__",
    "document": "65465412",
    "age": 45,
    "district": 20,
    "address": "laskdjf",
    "handicapped":true,
    "campaign": 13
}
#+end_src

** Donation
*** Create donation
#+begin_src restclient
POST :base-url/donation
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
{
  "name": "Lentejas",
  "description": "Bolsas de 1kg",
  "category": "Viveres",
  "amountByBeneficiary": 2,
  "campaign": "2",
}
#+end_src

*** Get donations by campaign
#+begin_src restclient
GET :base-url/donation?idCampaign=2
Authorization: Bearer :token
#+end_src

*** Update donation
#+begin_src restclient
PUT :base-url/donation
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
{
    "id": 5,
    "name": "Lentejes",
    "description": "Bolsas de 1kg",
    "category": "Viveres",
    "amountByBeneficiary": 2,
    "campaign": "2",
}
#+end_src

*** Delete donation
#+begin_src restclient
PUT :base-url/donation/remove
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
{
    "id": 12,
    "name": "Lentejas",
    "description": "Bolsas de 1kg",
    "category": "Viveres",
    "amountByBeneficiary": 2,
    "campaign": "2",
}
#+end_src

** Volunteer
*** Add volunteer
#+begin_src restclient
POST :base-url/volunteer
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
{
    "name": "Carmelolll",
    "lastname": "Gallo perez",
    "phone": "0982374098324",
    "email": "vv@gmail.com",
    "campaign": 2
}
#+end_src

*** Get by campaign
#+begin_src restclient
GET :base-url/volunteer/2
Content-Type: application/json;charset=UTF-8
Authorization: Bearer :token
#+end_src

#+RESULTS:
#+BEGIN_SRC js
[
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jj@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jjjkk@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jjjkk@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jjjkk@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "jjjkk@gmail.com"
  },
  {
    "name": "carmelolll",
    "lastname": "gallo perez",
    "phone": "0982374098324",
    "email": "vv@gmail.com"
  }
]
// GET http://localhost:4000/volunteer/2
// HTTP/1.1 200 OK
// Vary: Origin
// Content-Type: application/json; charset=utf-8
// Content-Length: 1517
// Date: Wed, 05 May 2021 06:54:59 GMT
// Connection: keep-alive
// Keep-Alive: timeout=5
// Request duration: 0.062789s
#+END_SRC
